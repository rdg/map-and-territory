flowchart TD
    Start[User working on map] --> NoSelection[Nothing selected]
    NoSelection --> MapProperties[Property panel shows map settings]
    
    %% Selection interactions
    NoSelection -->|Click terrain hex| SelectTerrain[Terrain hex selected]
    NoSelection -->|Click text element| SelectText[Text element selected]
    NoSelection -->|Click feature| SelectFeature[Feature selected]
    NoSelection -->|Drag select area| MultiSelect[Multiple elements selected]
    
    %% Terrain selection workflow
    SelectTerrain --> TerrainProps[Property panel shows terrain controls]
    TerrainProps --> TerrainEditing[Edit terrain type and style]
    TerrainProps --> GameplayProps[Set movement cost and visibility]
    
    %% Text selection workflow  
    SelectText --> TextProps[Property panel shows text formatting]
    TextProps --> TypographyEdit[Edit font style and size]
    TextProps --> ColorEdit[Change text color and effects]
    TextProps --> PositionEdit[Adjust position and rotation]
    
    %% Feature selection workflow
    SelectFeature --> FeatureProps[Property panel shows feature settings]
    FeatureProps --> FeatureType[Edit feature type and appearance]
    FeatureProps --> FeatureScale[Adjust size and orientation]
    
    %% Multi-selection workflow
    MultiSelect --> BulkProps[Property panel shows bulk edit options]
    BulkProps --> ApplyToAll[Apply changes to all selected]
    
    %% Context synchronization
    SelectTerrain --> SceneHighlight[Scene panel highlights selection]
    SelectText --> SceneHighlight
    SelectFeature --> SceneHighlight
    
    SceneHighlight --> CanvasHighlight[Canvas shows selection indicator]
    CanvasHighlight --> StatusUpdate[Status bar shows selection info]
    
    %% Deselection
    SelectTerrain -->|Press Escape| NoSelection
    SelectText -->|Press Escape| NoSelection
    SelectFeature -->|Press Escape| NoSelection
    MultiSelect -->|Press Escape| NoSelection
    
    SelectTerrain -->|Click empty space| NoSelection
    SelectText -->|Click empty space| NoSelection
    SelectFeature -->|Click empty space| NoSelection
    
    %% Tool switching affects context
    TerrainEditing -->|Select text tool| TextTool[Text creation mode]
    TextProps -->|Select terrain tool| TerrainTool[Terrain painting mode]
    
    TextTool --> TextProps
    TerrainTool --> TerrainProps
    
    %% Link to prototype states
    MapProperties -.-> IndexState["index.html"]
    TerrainProps -.-> TerrainState["context-terrain.html"]
    TextProps -.-> TextState["context-text.html"]
    SceneHighlight -.-> SyncState["Selection synchronized across panels"]
    
    %% Styling
    classDef prototypeLink fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,stroke-dasharray: 5 5
    classDef selectionState fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef propertyPanel fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef toolMode fill:#fff8e1,stroke:#f57c00,stroke-width:2px
    
    class IndexState,TerrainState,TextState,SyncState prototypeLink
    class SelectTerrain,SelectText,SelectFeature,MultiSelect selectionState
    class TerrainProps,TextProps,FeatureProps,BulkProps propertyPanel
    class TextTool,TerrainTool toolMode