flowchart TD
    Start[User has one map open] --> SingleMap[Single map tab visible]
    
    %% Opening additional maps
    SingleMap -->|Ctrl+T or File > New| NewMapDialog[New map dialog]
    SingleMap -->|File > Open| OpenDialog[Open existing map]
    
    NewMapDialog --> MultiTabState[Multiple tabs visible]
    OpenDialog --> MultiTabState
    
    %% Tab management
    MultiTabState -->|Click tab| SwitchDocument[Switch to selected map]
    MultiTabState -->|Middle click tab| CloseMap[Close map tab]
    MultiTabState -->|Ctrl+Tab| CycleNext[Cycle to next tab]
    MultiTabState -->|Ctrl+Shift+Tab| CyclePrev[Cycle to previous tab]
    
    SwitchDocument --> UpdateContext[Scene and property panels update]
    UpdateContext --> ActiveDocument[New document is active]
    
    %% Context switching
    ActiveDocument --> SceneUpdates[Scene shows layers for active map]
    ActiveDocument --> PropUpdates[Properties show settings for active map]
    
    %% Closing behavior
    CloseMap -->|Last tab remaining| SingleMap
    CloseMap -->|Multiple tabs remain| MultiTabState
    
    %% Save operations
    MultiTabState -->|Ctrl+S| SaveCurrent[Save active map]
    MultiTabState -->|Ctrl+Shift+S| SaveAll[Save all open maps]
    
    %% Export workflows
    ActiveDocument -->|Export current| ExportOne[Export active map only]
    MultiTabState -->|Export all| ExportCampaign[Export as campaign pack]
    
    %% Return paths
    SaveCurrent --> ActiveDocument
    SaveAll --> MultiTabState
    ActiveDocument --> MultiTabState
    CycleNext --> ActiveDocument
    CyclePrev --> ActiveDocument
    
    %% Link to prototype states
    SingleMap -.-> IndexState["index.html"]
    MultiTabState -.-> MultiState["multi-tab.html"]
    UpdateContext -.-> ContextSwitch["Properties adapt to selection"]
    
    %% Styling
    classDef prototypeLink fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px,stroke-dasharray: 5 5
    classDef userAction fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef systemResponse fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    
    class IndexState,MultiState,ContextSwitch prototypeLink
    class NewMapDialog,OpenDialog,SwitchDocument,CloseMap userAction
    class UpdateContext,SceneUpdates,PropUpdates systemResponse